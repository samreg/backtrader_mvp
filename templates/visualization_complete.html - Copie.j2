<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Backtest - @@SYMBOL@@ @@TIMEFRAME@@ - @@STRATEGY_NAME@@</title>

<script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background:#1a1d29;
    color:#d1d4dc;
    height:100vh;
}
.header {
    background:#2a2e39;
    padding:16px 24px;
    border-bottom:1px solid rgba(77,208,225,.2);
}
.title {
    font-size:22px;
    font-weight:700;
    color:#4dd0e1;
}
.stats-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
    gap:12px;
    margin-top:12px;
}
.stat-card {
    background:#1e222d;
    border-radius:6px;
    padding:10px;
}
.stat-label { font-size:11px; color:#888; }
.stat-value { font-size:18px; font-weight:700; }
.stat-green { color:#26a69a; }
.stat-red { color:#ef5350; }
.stat-blue { color:#4dd0e1; }

.chart-wrapper {
    display:flex;
    flex-direction:column;
    height:calc(100vh - 180px);
    padding:12px;
    gap:12px;
}
.main-chart-container,
.rsi-chart-container {
    background:#1a1d29;
    border-radius:8px;
    position:relative;
}
.main-chart-container { flex:3; }
.rsi-chart-container { flex:1; }
#chart,#rsiChart { width:100%; height:100%; }
</style>
</head>

<body>
<div class="header">
  <div class="title">ðŸ“Š Backtest @@SYMBOL@@ â€“ @@TIMEFRAME@@ â€“ @@STRATEGY_NAME@@</div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Total Trades</div>
      <div class="stat-value stat-blue">@@TOTAL_TRADES@@</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Win Rate</div>
      <div class="stat-value">@@WIN_RATE@@%</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">PnL Total</div>
      <div class="stat-value">@@TOTAL_PNL@@</div>
      @@PNL_BRUT_BLOCK@@
    </div>
    <div class="stat-card">
      <div class="stat-label">Profit Factor</div>
      <div class="stat-value">@@PROFIT_FACTOR@@</div>
    </div>
  </div>
</div>

<div class="chart-wrapper">
  <div class="main-chart-container">
    <div id="chart"></div>
  </div>
  <div class="rsi-chart-container">
    <div id="rsiChart"></div>
  </div>
</div>

<script>
const candlesData = @@CANDLES_JSON@@;
const bbUpperData = @@BB_UPPER_JSON@@;
const bbMiddleData = @@BB_MIDDLE_JSON@@;
const bbLowerData = @@BB_LOWER_JSON@@;
const rsiData = @@RSI_JSON@@;

let chart, rsiChart;

function initCharts() {
  chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout:{ background:{color:'#1a1d29'}, textColor:'#d1d4dc' },
    timeScale:{ timeVisible:true }
  });

  const candles = chart.addCandlestickSeries();
  candles.setData(candlesData);

  chart.addLineSeries({color:'#2196F3'}).setData(bbUpperData);
  chart.addLineSeries({color:'#9C27B0'}).setData(bbMiddleData);
  chart.addLineSeries({color:'#2196F3'}).setData(bbLowerData);

  rsiChart = LightweightCharts.createChart(document.getElementById('rsiChart'), {
    layout:{ background:{color:'#1a1d29'}, textColor:'#d1d4dc' },
    timeScale:{ timeVisible:true }
  });
  rsiChart.addLineSeries({color:'#9C27B0'}).setData(rsiData);

  chart.timeScale().fitContent();
}

window.addEventListener('load', initCharts);
</script>

</body>
</html>
